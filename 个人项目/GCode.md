# 为什么要做这个项目
之前没有全栈开发的经验，不是做前端就是负责后端，没有试过自己独立去完成从构思到落地一个项目。同时想要通过做一个项目来学习一下springboot，而恰好之前在美国也经常刷lc，所以想自己实现属于自己的oj平台。
# 介绍
是一个仿leetcode写的网站，主要用到Springboot，mysql，activemq。
# 系统架构&主要流程
主要说一下后端，后端分为应用服务和判题服务，应用服务就是处理用户的request，判题服务专门处理判题。

用户在网页上编写代码，然后点击提交，后端收到提交请求后，会把提交信息包括：

```
- submission_id
- code
- date
- user_id
- language
- 使用内存（初始为0）
- 运行使用时间（初始为0）
- 通过率
```
持久化到mysql，存储到mysql成功的话，就会返回ok，让客户端跳转到提交列表页面，然后调用接口同步获取提交运行的结果（利用sseemitter作消息推送）。

同时将submission_id作为消息发送到mq（通过事务来保证消息发送不丢失）。

判题机服务作为消费者，收到消息后，首先通过redis判断是否消费过这个submission_id（防止重复消费），接着根据submission_id从数据库取到submission对象，将其中的code存到一个脚本文件（比如java的话就存储为java文件），然后通过java的runtime执行相对应脚本文件，调用从网上找的一个脚本获取运行时间和内存。

判题过程就是一个for循环，遍历testcase，通过对testcase的答案和脚本运行结果比较，得到通过率，然后更新到mysql。

最后得到结果会通过sseemitter返回给客户端，完成一次提交操作。


# 遇到的问题
## 一
一直报错说找不到我的xml文件，后来发现是因为在maven工程中，xml文件建议写在resources目录下，但是我是直接写在包下的，maven在运行的时候会自动忽略，因此在pom.xml文件中重新指明资源文件配置<include>**/*.xml</include> 
![img](../img/gcode1.png)
![img](../img/gcode2.png)

## 二
如何获取运行时间和内存的问题。

解决办法是在网上找到一个python的脚本，在脚本中调用运行提交代码的方法，如何在判题服务中调用这个脚本。

## 三（还没解决）
安全问题，有可能用户会输入一些恶意代码，如果我不加鉴别，直接把提交的代码保存并运行，有可能损害本地机器。

# mq比较
![img](../img/mq.png)