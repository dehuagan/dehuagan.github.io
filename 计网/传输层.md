# SYN超时怎么办？
> 客户端发送SYN至服务端，然后就挂了，此时服务端发送SYN+ACK就一直得不到回，于是它会慢慢重试，阶梯性重试，比如linux默认重试5次，间隔是1s，2s，4s，8s，16s，再第五次还得等32s才能知道这次重试的结果，所以一共等63s才能断开连接。

# SYN Flood攻击
> SYN超时需要耗费服务端63s才会断开连接，也就是说63s内服务端需要保持足够资源，所以坏人就有可能构造出大量的客户端向服务端发送SYN，但就是不回复，使得服务端的SYN队列耗尽，无法处理正常的连接请求。

## 解决
> 可以开启 tcp_syncookies，那就用不到 SYN 队列了。
> SYN 队列满了之后 TCP 根据自己的 ip、端口、然后对方的 ip、端口，对方 SYN 的序号，时间戳等一波操作生成一个特殊的序号（即 cookie）发回去，如果对方是正常的 client 会把这个序号发回来，然后 server 根据这个序号建连。
或者调整 tcp_synack_retries 减少重试的次数，设置 tcp_max_syn_backlog 增加 SYN 队列数，设置 tcp_abort_on_overflow SYN 队列满了直接拒绝连接。